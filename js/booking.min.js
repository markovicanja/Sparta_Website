currentExercise="";

function rowFilter(activeText, onclickText, idText, justText) {
    return '<li class="list-group-item '+activeText+'" onclick="'+onclickText+'" id="'+idText+'">'+justText+'</li>';
}

function rowExercise(activeText, idText, justText) {
    common='" onclick="clickExercise(this.id)';
    return '<li class="list-group-item '+activeText+'" id="'+idText+common+'">'+justText+'</li>';
}

function rowDay(justText, num, buttonID) {
    button='';
    if (num!='') button='<button type="button" class="btn btn-secondary" id="' + buttonID + '" onclick="buttonClick(this.id)">Rezerviši</button>';
    return '<li class="list-group-item d-flex justify-content-between align-items-center">'+justText+'<span class="badge badge-secondary badge-pill">'+num+'</span>'+
        button+'</li>'; 
}

function filter(id) {
    active1=active2=active3=active4=active5='';
    if (id=='AllFilter') active1="active";
    if (id=='YogaFilter') active2="active";
    if (id=='PilatesFilter') active3="active";
    if (id=='CoreFilter') active4="active";
    if (id=='CardioFilter') active5="active";

    newInnerHTML=rowFilter(active1,"filter(this.id)", "AllFilter","Sve")+
        rowFilter(active2,"filter(this.id)", "YogaFilter","Yoga")+
        rowFilter(active3,"filter(this.id)", "PilatesFilter","Pilates")+
        rowFilter(active4,"filter(this.id)", "CoreFilter","Core")+
        rowFilter(active5,"filter(this.id)", "CardioFilter","Kardio");
    document.getElementById('listFilter').innerHTML=newInnerHTML;

    if (id=='AllFilter') {
        document.getElementById('hiddenFilter').value="Sve";
        currentExercise=firstExercise="Jutarnja joga";
        newInnerHTML=rowExercise("active", "1", "Jutarnja joga")+
        rowExercise("", "2", "Aštanga joga")+
        rowExercise("", "3", "Hatha joga")+
        rowExercise("", "4", "Klasični pilates")+
        rowExercise("", "5", "Reformer pilates")+
        rowExercise("", "6", "Stot pilates")+
        rowExercise("", "7", "Crossfit")+
        rowExercise("", "8", "Spartanac")+
        rowExercise("", "9", "Body sculpting")+
        rowExercise("", "10", "Core")+
        rowExercise("", "11", "Kardio Boks")+
        rowExercise("", "12", "Aerobni napad")+
        rowExercise("", "13", "Zumba");
        document.getElementById('listExercise').innerHTML=newInnerHTML;
    }
    if (id=='YogaFilter') {
        document.getElementById('hiddenFilter').value="Yoga";
        currentExercise=firstExercise="Jutarnja joga";
        newInnerHTML=rowExercise("active", "1", "Jutarnja joga")+
        rowExercise("", "2", "Aštanga joga")+
        rowExercise("", "3", "Hatha joga");
        document.getElementById('listExercise').innerHTML=newInnerHTML;
    }
    if (id=='PilatesFilter') {
        document.getElementById('hiddenFilter').value="Pilates";
        currentExercise=firstExercise="Klasični pilates";
        newInnerHTML=rowExercise("active", "4", "Klasični pilates")+
        rowExercise("", "5", "Reformer pilates")+
        rowExercise("", "6", "Stot pilates");
        document.getElementById('listExercise').innerHTML=newInnerHTML;
    }
    if (id=='CoreFilter') {
        document.getElementById('hiddenFilter').value="Core";
        currentExercise=firstExercise="Crossfit";
        newInnerHTML=rowExercise("active", "7", "Crossfit")+
        rowExercise("", "8", "Spartanac")+
        rowExercise("", "9", "Body sculpting")+
        rowExercise("", "10", "Core");
        document.getElementById('listExercise').innerHTML=newInnerHTML;
    }
    if (id=='CardioFilter') {
        document.getElementById('hiddenFilter').value="Cardio";
        currentExercise=firstExercise="Kardio Boks";
        newInnerHTML=rowExercise("active", "11", "Kardio Boks")+
        rowExercise("", "12", "Aerobni napad")+
        rowExercise("", "13", "Zumba");
        document.getElementById('listExercise').innerHTML=newInnerHTML;
    }

    checkDays(firstExercise);
}

function checkDays(exercise) {
    svakiDan=[6, 11, 18, 23, 29, 33, 35];
    j=0;

    dani=document.getElementById('raspored').getElementsByClassName("top-info");
    treninzi=document.getElementById('raspored').getElementsByClassName("single-event");
    document.getElementById('listDay').innerHTML='';

    buttonID=50;
    for (i=0; i<dani.length ; i++) {
        dan=dani[i].textContent;
        for (; j<svakiDan[i]; j++) {
            trening=treninzi[j].textContent;
            patt = new RegExp(exercise);
            if (patt.exec(trening)!=null) {
                buttonID++;
                red='';
                dan=dan.replace(/\s/g, '').substr(0,3)+'  ';
                trening=trening.replace(/\s/g, '').substr(0,11);
                trening=trening.slice(0,5)+' '+'-'+' '+trening.slice(6,11);
                red+=dan;
                red+=trening;
                broj=(Math.floor(Math.random() * 10));
                if (broj==0) broj='';
                document.getElementById('listDay').innerHTML+=rowDay(red, broj, buttonID);
            }
        } 
    }
}

function clickExercise(id) {
    
    currFilter=document.getElementById('hiddenFilter').value;
    active=['','','','','','','','','','','','','',''];

    active[id]='active';
    currentExercise=exerciseName=document.getElementById(id).textContent;
    completeHTML='';

    if (currFilter=='Sve' || currFilter=='Yoga') completeHTML+=rowExercise(active[1], "1", "Jutarnja joga");
    if (currFilter=='Sve' || currFilter=='Yoga') completeHTML+=rowExercise(active[2], "2", "Aštanga joga");
    if (currFilter=='Sve' || currFilter=='Yoga') completeHTML+=rowExercise(active[3], "3", "Hatha joga");
    if (currFilter=='Sve' || currFilter=='Pilates') completeHTML+=rowExercise(active[4], "4", "Klasični pilates");
    if (currFilter=='Sve' || currFilter=='Pilates') completeHTML+=rowExercise(active[5], "5", "Reformer pilates");
    if (currFilter=='Sve' || currFilter=='Pilates') completeHTML+=rowExercise(active[6], "6", "Stot pilates");
    if (currFilter=='Sve' || currFilter=='Core') completeHTML+=rowExercise(active[7], "7", "Crossfit");
    if (currFilter=='Sve' || currFilter=='Core') completeHTML+=rowExercise(active[8], "8", "Spartanac");
    if (currFilter=='Sve' || currFilter=='Core') completeHTML+=rowExercise(active[9], "9", "Body sculpting");
    if (currFilter=='Sve' || currFilter=='Core') completeHTML+=rowExercise(active[10], "10", "Core");
    if (currFilter=='Sve' || currFilter=='Cardio') completeHTML+=rowExercise(active[11], "11", "Kardio Boks");
    if (currFilter=='Sve' || currFilter=='Cardio') completeHTML+=rowExercise(active[12], "12", "Aerobni napad");
    if (currFilter=='Sve' || currFilter=='Cardio') completeHTML+=rowExercise(active[13], "13", "Zumba");

    document.getElementById('listExercise').innerHTML=completeHTML;
    checkDays(exerciseName);
}

function filter1() {filter('AllFilter');}

setTimeout(function filter1(){
    document.getElementById('listDay').innerHTML='';
    filter('AllFilter');
}, 50);

function buttonClick(id) {
    dani={};
    dani['Ned']=0; dani['Pon']=1; dani['Uto']=2; dani['Sre']=3; dani['Čet']=4; dani['Pet']=5; dani['Sub']=6;
    danVreme=document.getElementById(id).parentElement.textContent.slice(0,18);
    trening=currentExercise;
    
    dan=danVreme.slice(0,3);
    dan=dani[dan];
    vreme=danVreme.slice(5,18);

    sledeciDan=new Date();
    i=0;
    while (dan!=sledeciDan.getDay()) {
        sledeciDan.setDate(new Date().getDate()+i);
        i++;
    }
    if (i==0) {
        trenutnoSati=(new Date()).getHours();
        treningPocinje=vreme.slice(0,2);
        if (treningPocinje.charAt(0)=='0') treningPocinje=treningPocinje.slice(1,2);
        if (treningPocinje<=trenutnoSati) sledeciDan.setDate(new Date().getDate()+7);
    }
    reservePlace(sledeciDan, vreme, trening);

    // someDay=new Date();
    // someDay.setDate(new Date().getDate()+15);
    // alert(someDay);
}

function reservePlace(date, time, exercise) {
    trening=exercise;
    zero='';
    if (date.getMonth()<9) zero='0';
    datum=date.toString().slice(8,10)+'.'+zero+(date.getMonth()+1)+'.'+(date.getYear()+1900);
    vreme=time.slice(0,5);
    termin=datum+' '+vreme+' '+trening;

    countAdrian=sessionStorage.getItem("cntA");
    countJelica=sessionStorage.getItem("cntJ");

    user=sessionStorage.getItem("user");
    index='';
    if (user=="Adrian") {
        index='numA'+countAdrian;
        countAdrian++;
    }
    else {
        index='numJ'+countJelica;
        countJelica++;
    }

    sessionStorage.setItem('cntA', countAdrian);
    sessionStorage.setItem('cntJ', countJelica);
    sessionStorage.setItem(index, termin);
} 

function logOut() {
    sessionStorage.clear();
}

initialHTML='<table><thead></thead><tr><td colspan="4" align="center">Nemate zakazanih termina</td></tr></table>';

function cancelPlace(rowID) {
    rowID="#"+rowID;
    $(rowID).remove();
    count=0;
    if (user=="Adrian") {
        count=sessionStorage.getItem("cntA");
    }
    else {
        count=sessionStorage.getItem("cntJ");
    }
    removed=sessionStorage.getItem("removed");
    removedNum=parseInt(sessionStorage.getItem("removedNum"));
    removed=""+removed+rowID;
    removedNum+=1;
    sessionStorage.setItem("removed", removed);
    sessionStorage.setItem("removedNum", removedNum);
    if (removedNum==count) document.getElementById('res').innerHTML=initialHTML;
}
